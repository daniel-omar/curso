  <!DOCTYPE html>
  <html lang="en" dir="ltr">

  <head>
    <meta charset="utf-8">
    <title>PROYECTO CON JS</title>

    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" id="theme">

    <!-- <link rel="stylesheet" href="css/jquery-ui/jquery-ui.min.css">
  <link rel="stylesheet" href="css/jquery-ui/jquery-ui.structure.css">
  <link rel="stylesheet" href="css/jquery-ui/jquery-ui.theme.css"> -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.3.1/css/ol.css" type="text/css">
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" type="text/css"> -->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap-select/css/bootstrap-select.min.css">

    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=fetch,requestAnimationFrame,Element.prototype.classList,URL"></script>
    <script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
    <!-- <script src="js/jquery-ui/jquery-ui.min.js" charset="utf-8"></script> -->
    <script src="js/moment/moment.min.js" charset="utf-8"></script>
    <script src="js/bootstrap-select/js/bootstrap-select.min.js" charset="utf-8"></script>

    <script src="js/main.js" charset="utf-8"></script>
    <style media="screen">
      .map {
        width: 100%;
        height: 400px;
      }

      .popover-content {
        min-width: 180px;
      }
    </style>

  </head>

  <body>
    <div id="selector-theme">
      <div id="to-green">

      </div>
      <div id="to-red">

      </div>
      <div id="to-blue">

      </div>
    </div>
    <section id="global">
      <header>
        <div id="logo">
          <h1>PROYECTO JS</h1>
        </div>
        <div class="clearfix"></div>
        <nav id="menu">
          <ul>
            <li><a href="index.html">INICIO</a></li>
            <li><a href="reloj.html">RELOJ</a></li>
            <li><a href="about.html">SOBRE MI</a></li>
            <li><a href="contacto.html">CONTACTO</a></li>
          </ul>
        </nav>
      </header>
      <!-- Control+Alt+B=Autocorrector -->

      <section id="content">
        <div id="box">
          <!-- Cargar acordeon -->
          <div id="reloj">

          </div>
          <div id="map" class="map">
          </div>
          <div id="popup" title="Welcome to ol3"></div>
          <select id="layer-select" multiple>
            <option value="primero">primero</option>
            <option value="segundo" selected>segundo</option>
            <option value="tercero">tercero</option>
          </select>
        </div>
        <aside id="sidebar">
          <div id="about">
            <h4><span>¿Quien soy?</span></h4>
            <img src="img/caracol.jpg" alt="">
            <p>
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi metus metus, cursus vel neque et, posuere convallis leo.
            </p>
          </div>
          <div id="login">
            <h4><span>Identificate</span></h4>
            <form id="formulario">
              <label for="txtNombre">Nombre</label>
              <input type="text" name="txtNombre" id="txtNombre" value="">
              <label for="txtEmail">Email</label>
              <input type="email" name="txtApellido" id="txtEmail" value="">
              <label for="txtPassword">Contraseña</label>
              <input type="password" name="txtPassword" id="txtPassword" autocomplete="on">
              <input type="submit" name="btnRegistrar" id="btnRegistrar" value="Registrar">
            </form>
          </div>
        </aside>
        <div class="clearfix"></div>
      </section>
    </section>
    <footer>
      <span>MAster en Javascript</span>
      <a href="#" class="up">Ir a inicio</a>
    </footer>

    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.3.1/build/ol.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>



    <script type="text/javascript">
      var mapa;
      var markers;
      // marcadores debe ser un arreglo
      var marcadores = []; // Arreglo para que se puedan agregar otros más tarde
      // marcadores.push(marcador)
      // console.log(marcadores);
      var iconos1 = [{
          latitud: -12.052600,
          longitud: -77.010035,
          name: 'icono1',
          apellido: 'primero'
        },
        {
          latitud: -12.091333,
          longitud: -77.003474,
          name: 'icono2',
          apellido: 'primero'
        }
      ]
      var iconos2 = [{
          latitud: -12.052600,
          longitud: -77.010035,
          name: 'icono1',
          apellido: 'segundo'
        },
        {
          latitud: -12.091333,
          longitud: -77.003474,
          name: 'icono2',
          apellido: 'segundo'
        },
        {
          latitud: -12.110591,
          longitud: -77.033305,
          name: 'segundo'
        }
      ]
      var iconos3 = [{
          latitud: -12.052600,
          longitud: -77.010035,
          name: 'icono1',
          apellido: 'tercero'
        },
        {
          latitud: -12.091333,
          longitud: -77.003474,
          name: 'icono2',
          apellido: 'tercero'
        },
        {
          latitud: -12.110591,
          longitud: -77.033305,
          name: 'icono3',
          apellido: 'tercero'
        },
        {
          latitud: -12.138575,
          longitud: -77.006831,
          name: 'icono4',
          apellido: 'tercero'
        },
        {
          latitud: -12.104125,
          longitud: -76.973491,
          name: 'icono5',
          apellido: 'tercero'
        }
      ]
      const LATITUD_CENTRO = -12.066878,
        LONGITUD_CENTRO = -77.008814,
        ZOOM = 6;

      var seleccion;
      // var capa = new ol.layer.Vector();
      // var source=new ol.source.Vector()

      var source = new ol.source.Vector();
      //console.log(vectorSource);

      //vectorSource.addFeature(iconFeature);

      // var capa = new ol.layer.Vector();


      var lon, lat


      window.addEventListener('load', function() {

        $("#layer-select").selectpicker()

        ejecutar()

        var element = document.getElementById('popup')
        var popup = new ol.Overlay({
          element: element
        });
        mapa.addOverlay(popup);
        mapa.on('click', function(evt) {
          var feature = mapa.forEachFeatureAtPixel(evt.pixel,
            function(feature) {
              return feature;
            });
          if (feature) {
            var coordinates = feature.getGeometry().getCoordinates();
            var nombre = feature.getProperties();


            var coordinate = evt.coordinate;
            var hdms = ol.coordinate.toStringHDMS(ol.proj.transform(
              coordinate, 'EPSG:3857', 'EPSG:4326'));

            console.log(hdms);
            console.log(nombre);
            popup.setPosition(coordinates);

            $(element).popover({
              'placement': 'top',
              'animation': false,
              'html': true,
              'content': '<p>Locacion del codigo es sas</p><code>' + hdms + '</code>'
            });
            $(element).popover('show');
          } else {
            $(element).popover('destroy');
          }

        });

      })


      function ejecutar() {
        init();
        loadMarkers(iconos2);
      }

      function init() {

        mapa = new ol.Map({
          target: 'map', // el id del elemento en donde se monta
          layers: [
            new ol.layer.Tile({
              source: new ol.source.OSM()
            })
          ],
          view: new ol.View({
            center: ol.proj.fromLonLat([LONGITUD_CENTRO, LATITUD_CENTRO]),
            zoom: ZOOM,
          })
        });

      }



      // let marcador = new ol.Feature({
      //   geometry: new ol.geom.Point(
      //     ol.proj.fromLonLat([-77.008814, -12.066878]) // En dónde se va a ubicar
      //   ),
      // });
      //
      // // Agregamos icono
      // marcador.setStyle(new ol.style.Style({
      //   image: new ol.style.Icon({
      //     src: "img/marcador.png",
      //     // the real size of your icon
      //     size: [100, 57],
      //     // the scale factor
      //     scale: 0.5
      //   })
      // }));

      //
      // console.log(iconos);
      // iconos.forEach((item, i) => {
      //   console.log(item.longitud + ' ' + item.latitud)
      //   let marcador = new ol.Feature({
      //     geometry: new ol.geom.Point(
      //       ol.proj.fromLonLat([item.longitud, item.latitud]) // En dónde se va a ubicar
      //     ),
      //   });
      //
      //   // Agregamos icono
      //   marcador.setStyle(new ol.style.Style({
      //     image: new ol.style.Icon({
      //       src: "img/marcador.png",
      //       // the real size of your icon
      //       size: [100, 57],
      //       // the scale factor
      //       scale: 0.5
      //     })
      //   }));
      //   marcadores.push(marcador);
      // });


      // var capa = new ol.layer.Vector({
      //   source: new ol.source.Vector({
      //     features: [marcadores], // A la capa le ponemos los marcadores
      //   }),
      // });



      function loadMarkers(iconos) {
        source.clear(true)
        iconos.forEach((item, i) => {
          marcadores = []
          console.log(item.longitud + ' ' + item.latitud)
          let marcador = new ol.Feature({
            geometry: new ol.geom.Point(
              ol.proj.fromLonLat([item.longitud, item.latitud]) // En dónde se va a ubicar
            ),
            name: item.name,
            apellido: item.apellido
          });

          // Agregamos icono
          marcador.setStyle(new ol.style.Style({
            image: new ol.style.Icon({
              src: "img/marcador.png",
              // the real size of your icon
              size: [100, 57],
              // the scale factor
              scale: 0.5
            })
          }));
          marcadores.push(marcador)

          source.addFeatures(marcadores)

        });
        var capa = new ol.layer.Vector();
        capa.setSource(source)
        mapa.addLayer(capa);


        // let marcador = new ol.Feature({
        //   geometry: new ol.geom.Point(
        //     ol.proj.fromLonLat([-77.008814, -12.066878]) // En dónde se va a ubicar
        //   ),
        // });
        //
        // // Agregamos icono
        // marcador.setStyle(new ol.style.Style({
        //   image: new ol.style.Icon({
        //     src: "img/marcador.png",
        //     // the real size of your icon
        //     size: [100, 57],
        //     // the scale factor
        //     scale: 0.5
        //   })
        // }));

        // marcadores.push(marcador); // Agregamos el marcador al arreglo
        //
        // let capa = new ol.layer.Vector({
        //   source: new ol.source.Vector({
        //     features: marcadores, // A la capa le ponemos los marcadores
        //   }),
        // });
        // mapa.addLayer(capa);
      }

      // document.getElementById('layer-select').addEventListener('change', (e) => {
      //   seleccion = document.getElementById('layer-select').value
      //   if (seleccion == 'primero') {
      //     loadMarkers(iconos1)
      //   } else if (seleccion == 'segundo') {
      //     loadMarkers(iconos2)
      //   } else if (seleccion == 'tercero') {
      //     loadMarkers(iconos3)
      //   }
      //
      // })

      $('#layer-select').on('changed.bs.select', function(e, clickedIndex, isSelected, previousValue) {

        if ($(this).val()!=null) {
          var seleccion = $(this).val().join()
          if (seleccion == 'primero') {
            loadMarkers(iconos1)
          } else if (seleccion == 'segundo') {
            loadMarkers(iconos2)
          } else if (seleccion == 'tercero') {
            loadMarkers(iconos3)
          }

        }

      });

      // mapa.on('singleclick', function(evt) {
      //   var feature = mapa.forEachFeatureAtPixel(evt.pixel, function(feature, layer) {
      //     // Aquí se puede filtrar la feature
      //     return feature;
      //   });
      //   if (feature) {
      //     console.log("Click en: ", feature);
      //   }
      // });



      //
      // for (var i = 0; i < length; i++) {
      //   l = mlayers.item(i);
      //
      //
      //   if (layer_name === l.get('name')) {
      //     var iconFeature = new ol.Feature({
      //       geometry: new ol.geom.Point(ol.proj.transform([position], 'EPSG:4326',
      //         'EPSG:3857'))
      //     });
      //     iconFeature.setStyle(iconStyle);
      //
      //     this.vectorLayer.getSource().addFeature(iconFeature);
      //     this.vectorLayer.clear();
      //     //   this.vectorLayer.redraw();
      //     //   this.vectorLayer.changed();
      //     //   this.vectorLayer.refresh({force:true});
      //
      //   }
      // }
      // var select = document.getElementById('layer-select');
      //
      // function onChange() {
      //   var style = select.value;
      //   for (var i = 0, ii = layers.length; i < ii; ++i) {
      //     layers[i].setVisible(styles[i] === style);
      //   }
      // }
      // select.addEventListener('change', onChange);
      // onChange();
    </script>
  </body>

  </html>
